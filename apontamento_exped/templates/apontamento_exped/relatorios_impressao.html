{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatórios - Expedição</title>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-4">
    <section class="cover-page">
        <div class="cover-inner">
            <div class="cover-brand">CEMAG</div>
            <div class="cover-title">Relatório de Expedição</div>
            <div class="cover-meta">
                <div><strong>Data:</strong> {{ data_consulta|date:"d/m/Y" }}</div>
                {% if cliente %}
                <div><strong>Cliente:</strong> {{ cliente }}</div>
                {% endif %}
            </div>
            <div class="cover-subtitle">Pacotes com imagens e itens detalhados</div>
        </div>
    </section>

    <div class="page-break"></div>

    {% if erro %}
    <div class="alert alert-danger">{{ erro }}</div>
    {% endif %}

    {% if data_str and not erro %}
    {% if cliente %}
    <div class="card mb-4">
        <div class="card-body">
            <h5 class="mb-3">Carretas solicitadas</h5>
            {% if carretas_cliente %}
                <table class="table table-sm table-bordered align-middle mb-0">
                    <thead>
                        <tr>
                            <th style="width: 60%;">Codigo</th>
                            <th style="width: 40%;">Quantidade</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for carreta in carretas_cliente %}
                        <tr>
                            <td>{{ carreta.codigo }}</td>
                            <td>{{ carreta.quantidade }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <div class="text-muted">Nenhuma carreta encontrada para este cliente na data selecionada.</div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <div class="row">
        <div class="col-12">
            <!-- <h4 class="mb-3">Relatório de pacotes - {{ data_consulta|date:"d/m/Y" }}</h4> -->

            {% if not cargas %}
                <div class="alert alert-warning">Nenhum pacote encontrado para esta data.</div>
            {% else %}
                {% for carga in cargas %}
                <div class="card mb-4">
                    <!-- <div class="card-header">
                        <strong>Cliente:</strong> {{ carga.cliente }}
                        <span class="ms-3"><strong>Carga:</strong> {{ carga.carga }}</span>
                        {% if carga.data_carga %}
                        <span class="ms-3"><strong>Data:</strong> {{ carga.data_carga|date:"d/m/Y" }}</span>
                        {% endif %}
                    </div> -->
                    <div class="card-body">
                        {% if carga.pacotes.all|length == 0 %}
                            <p class="text-muted">Nenhum pacote nesta carga.</p>
                        {% else %}
                            {% for pacote in carga.pacotes.all %}
                            <div class="mb-4">
                                <h6 class="mb-2">Pacote: {{ pacote.nome }}</h6>
                                <div class="mb-2">
                                    <strong>Itens:</strong>
                                    {% if pacote.itens.all|length == 0 %}
                                        <div class="text-muted">Sem itens vinculados.</div>
                                    {% else %}
                                        <table class="table table-sm table-bordered mt-2">
                                            <thead>
                                                <tr>
                                                    <th>Código</th>
                                                    <th>Descrição</th>
                                                    <th>Quantidade</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {% for item in pacote.itens.all %}
                                                <tr>
                                                    <td>{{ item.codigo.codigo }}</td>
                                                    <td>{{ item.codigo.descricao }}</td>
                                                    <td>{{ item.quantidade }}</td>
                                                </tr>
                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% endif %}
                                </div>

                                <div>
                                    <strong>Imagens:</strong>
                                    {% if pacote.pacote_imagem.all|length == 0 %}
                                        <div class="text-muted">Sem imagens anexadas.</div>
                                    {% else %}
                                        <div class="d-flex flex-wrap gap-2 mt-2">
                                            {% for imagem in pacote.pacote_imagem.all %}
                                                {% if imagem.arquivo %}
                                                <div class="border p-1">
                                                    <img src="{{ imagem.arquivo.url }}" alt="Imagem do pacote" class="img-pacote">
                                                </div>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<style>
    .cover-page {
        min-height: 70vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #f4f6f8 0%, #ffffff 60%);
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 48px 24px;
    }
    .cover-inner {
        text-align: center;
        max-width: 720px;
    }
    .cover-brand {
        font-size: 40px;
        letter-spacing: 6px;
        font-weight: 700;
        color: #111827;
    }
    .cover-title {
        font-size: 28px;
        font-weight: 600;
        color: #1f2937;
        margin-top: 12px;
    }
    .cover-meta {
        margin-top: 24px;
        font-size: 14px;
        color: #374151;
    }
    .cover-subtitle {
        margin-top: 24px;
        font-size: 14px;
        color: #6b7280;
        text-transform: uppercase;
        letter-spacing: 2px;
    }
    .page-break {
        height: 1px;
        margin: 32px 0;
    }
    .img-pacote {
        max-width: 260px;
        max-height: 200px;
        object-fit: contain;
        display: block;
    }
    @media print {
        .cover-page {
            border: none;
            background: #fff;
        }
        .page-break {
            page-break-after: always;
            margin: 0;
            height: 0;
        }
        .card {
            border: none;
        }
        .card-header {
            border-bottom: 1px solid #ccc;
            font-size: 12px;
        }
        table {
            font-size: 11px;
        }
        .img-pacote {
            max-width: 220px;
            max-height: 180px;
        }
        body {
            background: #fff;
        }
    }
</style>

{% if report_ready and not erro %}
<script>
    window.addEventListener('load', () => {
        window.print();
    });
</script>
{% endif %}
</body>
</html>
